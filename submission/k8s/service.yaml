# service.yaml — Video Processing Service
#
# WHY ClusterIP?
# The video-processor receives work from Kafka and is called only by other
# pods inside the cluster (e.g., api-gateway). It must NOT be exposed externally.
# ClusterIP gives it a stable internal DNS name:
#   video-processor.video-analytics.svc.cluster.local
#
# CRITICAL LESSON (from Scenario 2 — label mismatch):
# The selector here must EXACTLY match the pod template labels in deployment.yaml.
# If the service selector has extra labels the pods don't have (like "tier: backend"),
# Endpoints will be empty (<none>) and ALL traffic silently fails.
# We only select on "app: video-processor" to match our deployment exactly.

apiVersion: v1
kind: Service
metadata:
  name: video-processor
  namespace: video-analytics
  labels:
    app: video-processor
spec:
  type: ClusterIP

  # Selector must exactly match pod template labels in deployment.yaml.
  selector:
    app: video-processor

  ports:
  - name: http
    port: 8080        # Port that OTHER pods use to reach this service
    targetPort: 8080  # Port the container listens on (matches containerPort in deployment)
    protocol: TCP
